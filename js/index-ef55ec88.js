import{b7 as D,U as E,v as S,L as O,b8 as C,u as P,D as L,b9 as y,h as b,A as I}from"./index-b92ab863.js";function M(t){return D()?(C(t),!0):!1}function _(t){return typeof t=="function"?t():P(t)}const w=typeof window<"u",g=()=>{},T=B();function B(){var t;return w&&((t=window==null?void 0:window.navigator)==null?void 0:t.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent)}function q(t,r=!0){E()?S(t):r?t():O(t)}function m(t){var r;const u=_(t);return(r=u==null?void 0:u.$el)!=null?r:u}const k=w?window:void 0,W=w?window.navigator:void 0;function h(...t){let r,u,n,l;if(typeof t[0]=="string"||Array.isArray(t[0])?([u,n,l]=t,r=k):[r,u,n,l]=t,!r)return g;Array.isArray(u)||(u=[u]),Array.isArray(n)||(n=[n]);const d=[],i=()=>{d.forEach(a=>a()),d.length=0},s=(a,v,e,o)=>(a.addEventListener(v,e,o),()=>a.removeEventListener(v,e,o)),p=L(()=>[m(r),_(l)],([a,v])=>{i(),a&&d.push(...u.flatMap(e=>n.map(o=>s(a,e,o,v))))},{immediate:!0,flush:"post"}),f=()=>{p(),i()};return M(f),f}let A=!1;function F(t,r,u={}){const{window:n=k,ignore:l=[],capture:d=!0,detectIframe:i=!1}=u;if(!n)return;T&&!A&&(A=!0,Array.from(n.document.body.children).forEach(e=>e.addEventListener("click",g)),n.document.documentElement.addEventListener("click",g));let s=!0;const p=e=>l.some(o=>{if(typeof o=="string")return Array.from(n.document.querySelectorAll(o)).some(c=>c===e.target||e.composedPath().includes(c));{const c=m(o);return c&&(e.target===c||e.composedPath().includes(c))}}),a=[h(n,"click",e=>{const o=m(t);if(!(!o||o===e.target||e.composedPath().includes(o))){if(e.detail===0&&(s=!p(e)),!s){s=!0;return}r(e)}},{passive:!0,capture:d}),h(n,"pointerdown",e=>{const o=m(t);o&&(s=!e.composedPath().includes(o)&&!p(e))},{passive:!0}),i&&h(n,"blur",e=>{setTimeout(()=>{var o;const c=m(t);((o=n.document.activeElement)==null?void 0:o.tagName)==="IFRAME"&&!(c!=null&&c.contains(n.document.activeElement))&&r(e)},0)})].filter(Boolean);return()=>a.forEach(e=>e())}function x(){const t=b(!1);return E()&&S(()=>{t.value=!0}),t}function N(t){const r=x();return I(()=>(r.value,!!t()))}function G(t){let{acceptAllDevices:r=!1}=t||{};const{filters:u=void 0,optionalServices:n=void 0,navigator:l=W}=t||{},d=N(()=>l&&"bluetooth"in l),i=y(void 0),s=y(null);L(i,()=>{v()});async function p(){if(d.value){s.value=null,u&&u.length>0&&(r=!1);try{i.value=await(l==null?void 0:l.bluetooth.requestDevice({acceptAllDevices:r,filters:u,optionalServices:n}))}catch(e){s.value=e}}}const f=b(),a=I(()=>{var e;return((e=f.value)==null?void 0:e.connected)||!1});async function v(){if(s.value=null,i.value&&i.value.gatt){i.value.addEventListener("gattserverdisconnected",()=>{});try{f.value=await i.value.gatt.connect()}catch(e){s.value=e}}}return q(()=>{var e;i.value&&((e=i.value.gatt)==null||e.connect())}),M(()=>{var e;i.value&&((e=i.value.gatt)==null||e.disconnect())}),{isSupported:d,isConnected:a,device:i,requestDevice:p,server:f,error:s}}export{F as o,G as u};
